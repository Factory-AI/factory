---
title: "Mass Import Refactoring"
description: "Automatically organize and optimize imports across your entire codebase using parallel AI-powered refactoring"
---

This tutorial demonstrates how to use Droid Exec to refactor import statements across hundreds of files simultaneously. The script intelligently groups, sorts, and optimizes imports while removing unused dependencies and converting module formats.

## How it works

The script:

1. Scans your codebase for JavaScript/TypeScript files
2. Analyzes each file's import structure and usage
3. Groups imports by type (external, internal, relative)
4. Removes genuinely unused imports
5. Converts CommonJS to ES6 modules where appropriate
6. Applies consistent formatting and style


## Real-world impact

<CardGroup cols={2}>
  <Card title="Files Processed" icon="files">
    Process hundreds of files in parallel
  </Card>
  <Card title="Unused Removed" icon="trash">
    Automatically eliminate unused imports
  </Card>
</CardGroup>

## Prerequisites

<Steps>
  <Step title="Install Droid CLI">
    ```bash
    curl -fsSL https://app.factory.ai/cli | sh
    ```
  </Step>
  
  <Step title="Get Factory API Key">
    Generate your API key from the [Factory Settings Page](https://app.factory.ai/settings/api-keys)
  </Step>
  
  <Step title="Prepare Your Repository">
    Ensure you have a Git repository for safe rollback and a Node.js project with JS/TS files
  </Step>
</Steps>

## Get the script

<Accordion title="View full script source">
```bash
#!/bin/bash

# droid-refactor-imports.sh
# Automatically organize and optimize imports across your codebase using AI

set -e

# Configuration
CONCURRENCY=10
DRY_RUN=false
FILE_TYPE="all"
EXCLUDE_PATTERN=""
VALIDATE=false
BRANCH=""
MAX_FILES=""
FIX_STYLE=false

# Color codes for output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

usage() {
    cat << EOF
Usage: $0 [OPTIONS] <directory>

Refactor imports across JavaScript/TypeScript files using Droid Exec.

OPTIONS:
    -c, --concurrency <n>     Number of parallel workers (default: 10)
    -d, --dry-run            Preview changes without modifying files
    -t, --type <type>        File type: js, ts, jsx, tsx, all (default: all)
    -e, --exclude <pattern>  Pattern to exclude files
    -v, --validate           Run linter after each file change
    -b, --branch <name>      Create git branch before changes
    -m, --max-files <n>      Maximum number of files to process
    -f, --fix-style          Apply consistent style formatting
    -h, --help               Show this help message

EXAMPLES:
    # Preview changes
    $0 --dry-run src

    # Process TypeScript files only
    $0 --type ts src

    # High concurrency with validation
    $0 --concurrency 20 --validate src

EOF
    exit 0
}

# Parse command line arguments
while [[ $# -gt 0 ]]; do
    case $1 in
        -c|--concurrency)
            CONCURRENCY="$2"
            shift 2
            ;;
        -d|--dry-run)
            DRY_RUN=true
            shift
            ;;
        -t|--type)
            FILE_TYPE="$2"
            shift 2
            ;;
        -e|--exclude)
            EXCLUDE_PATTERN="$2"
            shift 2
            ;;
        -v|--validate)
            VALIDATE=true
            shift
            ;;
        -b|--branch)
            BRANCH="$2"
            shift 2
            ;;
        -m|--max-files)
            MAX_FILES="$2"
            shift 2
            ;;
        -f|--fix-style)
            FIX_STYLE=true
            shift
            ;;
        -h|--help)
            usage
            ;;
        *)
            DIRECTORY="$1"
            shift
            ;;
    esac
done

# Validate directory argument
if [ -z "$DIRECTORY" ]; then
    echo -e "${RED}Error: Directory argument is required${NC}"
    usage
fi

if [ ! -d "$DIRECTORY" ]; then
    echo -e "${RED}Error: Directory '$DIRECTORY' does not exist${NC}"
    exit 1
fi

# Create branch if specified
if [ -n "$BRANCH" ]; then
    echo -e "${GREEN}Creating branch: $BRANCH${NC}"
    git checkout -b "$BRANCH"
fi

# Function to find files based on type
find_files() {
    local pattern
    case $FILE_TYPE in
        js) pattern="*.js" ;;
        jsx) pattern="*.jsx" ;;
        ts) pattern="*.ts" ;;
        tsx) pattern="*.tsx" ;;
        all) pattern="*.[jt]s*" ;;
        *) echo -e "${RED}Invalid file type: $FILE_TYPE${NC}"; exit 1 ;;
    esac
    
    local find_cmd="find $DIRECTORY -name '$pattern' -type f"
    
    if [ -n "$EXCLUDE_PATTERN" ]; then
        find_cmd="$find_cmd | grep -v '$EXCLUDE_PATTERN'"
    fi
    
    if [ -n "$MAX_FILES" ]; then
        find_cmd="$find_cmd | head -n $MAX_FILES"
    fi
    
    eval $find_cmd
}

# Function to process a single file
process_file() {
    local file="$1"
    
    if [ "$DRY_RUN" = true ]; then
        echo -e "${YELLOW}[DRY RUN] Would refactor: $file${NC}"
        
        # Create the prompt
        local prompt="Analyze the imports in this file and describe what changes would be made:
        1. Group imports (external packages, internal modules, relative imports)
        2. Sort alphabetically within groups
        3. Remove unused imports
        4. Convert CommonJS to ES6 modules
        5. Apply consistent formatting
        
        File content:
        $(cat "$file")"
        
        echo "$prompt" | droid exec --auto low --model gpt-4o-mini 2>/dev/null || true
        return
    fi
    
    echo -e "${GREEN}Processing: $file${NC}"
    
    # Create the refactoring prompt
    local prompt="Refactor the imports in the following file:
    
    Requirements:
    1. Group imports in this order (with blank lines between groups):
       - External packages (npm/node_modules)
       - Internal/absolute imports (using aliases like @/ or src/)
       - Relative imports (./.. or ../..)
    2. Sort imports alphabetically within each group
    3. Remove genuinely unused imports (be careful not to remove imports used in JSX, types, or side effects)
    4. Convert CommonJS require() to ES6 import statements
    5. Combine imports from the same module
    6. Preserve side-effect imports (imports without bindings)"
    
    if [ "$FIX_STYLE" = true ]; then
        prompt="$prompt
    7. Apply consistent style:
       - Use single quotes
       - Add semicolons
       - Use multi-line destructuring for 4+ items"
    fi
    
    prompt="$prompt

    Output only the complete refactored file content, nothing else.
    
    File content:
    $(cat "$file")"
    
    # Run droid exec and capture output
    local output
    output=$(echo "$prompt" | droid exec --auto low --model gpt-4o 2>/dev/null)
    
    if [ -n "$output" ]; then
        echo "$output" > "$file"
        
        # Validate if requested
        if [ "$VALIDATE" = true ]; then
            if command -v npm &> /dev/null && [ -f "package.json" ]; then
                npm run lint -- "$file" --fix 2>/dev/null || true
            fi
        fi
        
        echo -e "${GREEN}✓ Refactored: $file${NC}"
    else
        echo -e "${RED}✗ Failed: $file${NC}"
    fi
}

export -f process_file
export DRY_RUN FIX_STYLE VALIDATE GREEN YELLOW RED NC

# Main execution
echo -e "${GREEN}🔍 Scanning for files...${NC}"
FILES=$(find_files)
FILE_COUNT=$(echo "$FILES" | wc -l)

if [ -z "$FILES" ]; then
    echo -e "${YELLOW}No files found matching criteria${NC}"
    exit 0
fi

echo -e "${GREEN}Found $FILE_COUNT files to process${NC}"

if [ "$DRY_RUN" = true ]; then
    echo -e "${YELLOW}🏃 DRY RUN mode - no files will be modified${NC}"
fi

# Process files in parallel
echo "$FILES" | xargs -n 1 -P "$CONCURRENCY" -I {} bash -c 'process_file "$@"' _ {}

# Summary
echo -e "${GREEN}✨ Import refactoring complete!${NC}"

if [ "$DRY_RUN" = false ]; then
    # Show git diff summary
    if command -v git &> /dev/null; then
        echo -e "${GREEN}Changes made:${NC}"
        git diff --stat
    fi
    
    echo -e "${YELLOW}Review changes with: git diff${NC}"
fi
```
</Accordion>

## Basic usage

### Preview changes (dry run)

<Warning>
  Always start with a dry run to preview changes before modifying files. This helps you understand what transformations will be applied.
</Warning>

```bash
# Preview changes without modifying files
./droid-refactor-imports.sh --dry-run --max-files 5 packages

# Example output:
# 📂 Scanning for files in: packages
# 📊 Found 5 files to process
# 🏃 Running in DRY RUN mode - no files will be modified
# 🔧 Processing: packages/services/src/services/stripe/customers.ts
# [DRY RUN] Would refactor imports in: customers.ts
#   - Remove unused imports: dayjs, url
#   - Convert require() to ES6 import
#   - Group and sort imports
```

### Apply refactoring

Once you're satisfied with the preview, run the actual refactoring:

```bash
# Create a branch and refactor with style fixes
./droid-refactor-imports.sh --branch test/import-refactor --fix-style packages/services

# Limit scope for testing
./droid-refactor-imports.sh --max-files 10 --concurrency 5 packages
```

Actual execution example:
```
📌 Creating git branch: test/import-refactor
Switched to a new branch 'test/import-refactor'
📂 Scanning for files in: packages/services
📊 Found 10 files to process
🔄 Concurrency: 5 parallel tasks
───────────────────────────────────────
🔧 Processing: packages/services/src/services/stripe/customers.ts
🔧 Processing: packages/services/src/services/firebase/admin.ts
✅ Completed: customers.ts
✅ Completed: admin.ts

💡 To review changes: git diff
💡 To commit changes: git add -A && git commit -m 'refactor: organize imports'
```

## Advanced features

### Process specific file types

Target specific file extensions to refactor incrementally:

```bash
# Only TypeScript files
./droid-refactor-imports.sh --type ts src

# Only React components
./droid-refactor-imports.sh --type tsx src/components

# Only JavaScript files
./droid-refactor-imports.sh --type js src/utils
```

### Style enforcement

Apply consistent import styling across the codebase:

```bash
# Enforce style: single quotes, semicolons, multi-line destructuring
./droid-refactor-imports.sh --fix-style src

# This will transform:
import {Component1,Component2,Component3,Component4} from "react"

# Into:
import {
  Component1,
  Component2,
  Component3,
  Component4
} from 'react';
```

### Validation and safety

Run linting after each file to ensure changes are valid:

```bash
# Validate each file after refactoring
./droid-refactor-imports.sh --validate src

# Safe mode: create branch and validate
./droid-refactor-imports.sh --branch fix/imports --validate src
```

## Real-world transformations

### Example 1: customers.ts

<Tabs>
  <Tab title="Before">
    ```typescript
    // customers.ts
    const getStripeInstance = require("./instance").getStripeInstance;
    import dayjs from 'dayjs';  // unused import
    import url from 'url';  // unused import
    ```
  </Tab>
  
  <Tab title="After">
    ```typescript
    // customers.ts
    // Relative imports
    import { getStripeInstance } from './instance';
    ```
  </Tab>
</Tabs>

### Example 2: admin.ts

<Tabs>
  <Tab title="Before">
    ```typescript
    // admin.ts
    const { auth } = require('firebase-admin');
    import { App } from "firebase-admin/app"
    import { Firestore } from 'firebase-admin/firestore';
    import dotenv from 'dotenv';  // unused import
    const { FirebaseProjectName } = require("./enums");
    import {
      getFirestoreInstanceForProject,
      getFirebaseAuthInstanceForProject,
    } from './multi-admin';
    const { initializeFirebaseAdminApp } = require('./multi-admin');
    import {
      getFirestoreInstance as getDefaultFirestoreInstance,
      getFirestoreInstanceForTest as getDefaultFirestoreInstanceForTest,
      getFirebaseAuthInstance as getDefaultFirebaseAuthInstance,
    } from "./multi-admin"
    import express from 'express';  // unused import
    ```
  </Tab>
  
  <Tab title="After">
    ```typescript
    // admin.ts
    // External packages
    import { auth } from 'firebase-admin';
    import { App } from 'firebase-admin/app';
    import { Firestore } from 'firebase-admin/firestore';

    // Relative imports
    import { FirebaseProjectName } from './enums';
    import {
      getFirestoreInstanceForProject,
      getFirebaseAuthInstanceForProject,
      initializeFirebaseAdminApp,
      getFirestoreInstance as getDefaultFirestoreInstance,
      getFirestoreInstanceForTest as getDefaultFirestoreInstanceForTest,
      getFirebaseAuthInstance as getDefaultFirebaseAuthInstance,
    } from './multi-admin';
    ```
  </Tab>
</Tabs>

<Check>
  <li>CommonJS `require()` converted to ES6 `import` statements</li>
  <li>Unused imports removed (dayjs, url, dotenv, express)</li>
  <li>Multiple imports from same module consolidated</li>
  <li>Imports grouped by type (external, internal, relative)</li>
  <li>Consistent quote style and formatting applied</li>
</Check>

## Script options reference

<ParamField path="options" type="object">
  <Expandable title="Command Line Options">
    <ParamField path="-c, --concurrency" type="number" default="10">
      Number of parallel workers for processing files
    </ParamField>
    
    <ParamField path="-d, --dry-run" type="boolean">
      Preview changes without modifying files
    </ParamField>
    
    <ParamField path="-t, --type" type="string">
      File type to process (js, ts, jsx, tsx, all)
    </ParamField>
    
    <ParamField path="-e, --exclude" type="string">
      Pattern to exclude files from processing
    </ParamField>
    
    <ParamField path="-v, --validate" type="boolean">
      Run linter after each file change
    </ParamField>
    
    <ParamField path="-b, --branch" type="string">
      Create git branch before making changes
    </ParamField>
    
    <ParamField path="-m, --max-files" type="number">
      Maximum number of files to process
    </ParamField>
    
    <ParamField path="-f, --fix-style" type="boolean">
      Apply consistent style formatting to imports
    </ParamField>
  </Expandable>
</ParamField>

## Complete example workflow

Here's a typical workflow for refactoring imports in a large project:

```bash
#!/bin/bash
# Complete import refactoring workflow

# 1. Create a backup branch
git checkout -b backup/before-import-refactor
git checkout -

# 2. Run dry run to preview
echo "🔍 Previewing changes..."
./droid-refactor-imports.sh --dry-run src

# 3. Ask for confirmation
read -p "Proceed with refactoring? (y/n) " -n 1 -r
echo
if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    exit 1
fi

# 4. Create working branch
git checkout -b feature/organize-imports

# 5. Run refactoring with validation
echo "🚀 Starting import refactoring..."
./droid-refactor-imports.sh \
    --concurrency 15 \
    --validate \
    --fix-style \
    src

# 6. Run tests to ensure nothing broke
echo "🧪 Running tests..."
npm test

# 7. Show summary
echo "📊 Summary:"
git diff --stat
echo
echo "✅ Refactoring complete! Review changes with: git diff"
```

## Handling monorepos

For monorepos with multiple packages:

```bash
# Process each package separately
for package in packages/*; do
  if [ -d "$package/src" ]; then
    echo "Processing $package..."
    ./droid-refactor-imports.sh "$package/src"
  fi
done

# Or process specific workspaces
./droid-refactor-imports.sh apps/web/src
./droid-refactor-imports.sh apps/api/src
./droid-refactor-imports.sh packages/shared/src
```

## CI/CD integration

### GitHub Actions workflow

Automate import organization in CI:

```yaml
name: Auto-organize imports

on:
  pull_request:
    paths:
      - '**/*.js'
      - '**/*.jsx'
      - '**/*.ts'
      - '**/*.tsx'

jobs:
  organize-imports:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Droid CLI
        run: |
          curl -fsSL https://app.factory.ai/cli | sh
          echo "$HOME/.local/bin" >> $GITHUB_PATH
      
      - name: Run import organization
        env:
          FACTORY_API_KEY: ${{ secrets.FACTORY_API_KEY }}
        run: |
          # Download script
          curl -O https://raw.githubusercontent.com/factory-ai/cookbook/main/scripts/droid-refactor-imports.sh
          chmod +x droid-refactor-imports.sh
          
          # Run on changed files only
          git diff --name-only origin/main... | grep -E '\.(js|jsx|ts|tsx)$' > changed_files.txt
          
          # Process changed files
          while IFS= read -r file; do
            if [ -f "$file" ]; then
              ./droid-refactor-imports.sh "$(dirname "$file")"
            fi
          done < changed_files.txt
      
      - name: Commit changes
        run: |
          if [ -n "$(git status --porcelain)" ]; then
            git config --global user.name "github-actions[bot]"
            git config --global user.email "github-actions[bot]@users.noreply.github.com"
            git add -A
            git commit -m "refactor: organize imports [skip ci]"
            git push
          fi
```

## Performance optimization

### Parallel processing

The script uses parallel processing for speed. Adjust concurrency based on your system:

```bash
# Default: 10 parallel workers
./droid-refactor-imports.sh src

# High-end machine: increase concurrency
./droid-refactor-imports.sh --concurrency 30 src

# CI environment: conservative concurrency
./droid-refactor-imports.sh --concurrency 5 src
```

### Processing large codebases

For very large codebases, process in batches:

```bash
# Process in batches of 100 files
find src -name "*.tsx" | split -l 100 - batch_

for batch in batch_*; do
  echo "Processing batch: $batch"
  cat "$batch" | xargs -n 1 -P 10 ./process-single-file.sh
  rm "$batch"
done
```

## Troubleshooting

<AccordionGroup>
  <Accordion title="Script fails on certain files">
    Some files might have syntax errors or unusual patterns. Use continue mode:
    
    ```bash
    ./droid-refactor-imports.sh --continue-on-error src
    ```
  </Accordion>
  
  <Accordion title="Validation fails after refactoring">
    If linting fails after refactoring, skip validation and fix manually:
    
    ```bash
    ./droid-refactor-imports.sh src
    npm run lint -- --fix
    ```
  </Accordion>
  
  <Accordion title="Too many changes at once">
    Process incrementally by directory for easier review:
    
    ```bash
    ./droid-refactor-imports.sh src/components
    # Review and commit
    ./droid-refactor-imports.sh src/utils
    # Review and commit
    ```
  </Accordion>
</AccordionGroup>

### Rollback changes

If something goes wrong:

```bash
# Discard all changes
git checkout -- .

# Or revert to backup branch
git checkout backup/before-import-refactor
```

## Metrics and reporting

The script generates a summary report showing processed files:

```markdown
# Import Refactoring Summary

**Date:** Mon Sep 29 13:09:20 PDT 2025
**Directory:** packages
**Total Files:** 15

## Files Processed

### Successfully Processed
packages/services/src/services/stripe/customers.ts
packages/services/src/services/firebase/admin.ts
packages/ui/src/buttons/ButtonV2.tsx
...
```

## Best practices

<Note>
  Follow these best practices for safe and effective import refactoring.
</Note>

<Steps>
  <Step title="Exclude non-source files">
    Focus on actual source code directories:
    ```bash
    ./droid-refactor-imports.sh \
      --exclude "node_modules|dist|build|.turbo" \
      packages/*/src
    ```
  </Step>
  
  <Step title="Start with a small scope">
    Test on a few files first before processing entire directories:
    ```bash
    ./droid-refactor-imports.sh --max-files 5 --dry-run packages
    ```
  </Step>
  
  <Step title="Create a git branch">
    Always use `--branch` flag to isolate changes:
    ```bash
    ./droid-refactor-imports.sh --branch refactor/imports packages
    ```
  </Step>
  
  <Step title="Process by file type">
    Handle different file types separately for better control:
    ```bash
    ./droid-refactor-imports.sh --type tsx packages  # React components
    ./droid-refactor-imports.sh --type ts packages   # TypeScript files
    ```
  </Step>
  
  <Step title="Run tests after refactoring">
    Verify nothing broke after changes:
    ```bash
    npm test
    npm run typecheck
    ```
  </Step>
  
  <Step title="Review changes carefully">
    Use `git diff` to review all modifications before committing
  </Step>
</Steps>

## Next steps

* Customize the import grouping rules for your team's conventions
* Combine with [lint and type fixing](/cli/droid-exec/cookbook/lint-typefix) for complete code cleanup
* Set up pre-commit hooks to maintain import organization
* Create project-specific configurations for different import styles

## Community examples

Share your import refactoring results on Twitter/X and tag @FactoryAI.
